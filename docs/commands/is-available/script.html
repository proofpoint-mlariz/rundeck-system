<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='content-type' content='text/html;charset=utf-8'>
    <title>is-available</title>
    <link rel="stylesheet" media="all" href="http://jashkenas.github.io/docco/resources/linear/public/stylesheets/normalize.css" />
    <link rel="stylesheet" media="all" href="http://jashkenas.github.io/docco/resources/linear/docco.css" />
</head>
<body>
<div class="container">
  <div class="page">
        <div class="header"><h1>is-available</h1></div>
        <p>Load the function library for this module.
This loads rerun functions, too.</p>

<div class="highlight"><pre>
<span class="c">#!/usr/bin/env bash</span>

<span class="c">#/ command: rundeck-loadbalancer-checks:is-available: &quot;the instance is available for traffic&quot;</span>
<span class="c">#/ usage: rerun rundeck-loadbalancer-checks:is-available  --thresholds &lt;&gt;  --profile &lt;&gt;</span>

. <span class="nv">$RERUN_MODULE_DIR</span>/lib/functions.sh is-available <span class="o">||</span> <span class="o">{</span>
  <span class="nb">echo</span> &gt;&amp;2 <span class="s2">&quot;Failed loading function library.&quot;</span> ; <span class="nb">exit </span>1 ; 
<span class="o">}</span>

</pre></div>

<h2>Fail fast</h2>

<div class="highlight"><pre>
<span class="nb">set</span> -e
<span class="nb">set</span> -o nounset -o pipefail

<span class="c">#/ rerun-variables: RERUN, RERUN_VERSION, RERUN_MODULES, RERUN_MODULE_DIR</span>
<span class="c">#/ option-variables: THRESHOLDS PROFILE</span>

rerun_options_parse <span class="s2">&quot;$@&quot;</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;-&quot;</span> <span class="o">==</span> <span class="s2">&quot;$PROFILE&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
<span class="k">	</span>rerun_log info <span class="s2">&quot;Reading profile from stdin&quot;</span>
	<span class="nv">PROFILE</span><span class="o">=</span><span class="k">$(</span>mktemp <span class="nv">$TMPDIR</span>/rundeck-loadbalancer-checks:is-available.XXXXXX<span class="k">)</span>
	cat &gt; <span class="nv">$PROFILE</span>
<span class="k">elif</span> <span class="o">[[</span> ! -f <span class="nv">$PROFILE</span> <span class="o">]]</span>
<span class="k">then</span>
<span class="k">	</span>rerun_die <span class="s2">&quot;Profile file not found: $PROFILE&quot;</span>
<span class="k">fi</span>

</pre></div>

<p>Generate a file if key=value pairs were given.</p>

<div class="highlight"><pre>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$THRESHOLDS&quot;</span> <span class="o">=</span>~ <span class="o">[</span>A-Z_<span class="o">]</span>+<span class="o">=[[</span>:alnum:<span class="o">]]</span>+ <span class="o">]]</span>
<span class="k">then</span>
<span class="k">	</span>rerun_log info <span class="s2">&quot;Reading thresholds from command line&quot;</span>
    <span class="nv">TMPFILE</span><span class="o">=</span><span class="k">$(</span>mktemp <span class="nv">$TMPDIR</span>/rundeck-loadbalancer-checks:is-available.XXXXXX<span class="k">)</span>
	<span class="nb">echo</span> <span class="nv">$THRESHOLDS</span> &gt; <span class="nv">$TMPFILE</span>
	<span class="nv">THRESHOLDS</span><span class="o">=</span><span class="nv">$TMPFILE</span>
<span class="k">fi</span>

</pre></div>

<p>The roundup tests will source the PROFILE and THRESHOLDS profiles</p>

<div class="highlight"><pre>
<span class="nb">cd</span> <span class="nv">$RERUN_MODULE_DIR</span>/lib/checks
./roundup is-available-test.sh

</pre></div>

<p>Done. Exit with last command exit status.</p>

<div class="highlight"><pre>
<span class="nb">exit</span> <span class="nv">$?</span>



<div class="highlight"><pre>
</pre></div>

</pre></div>
<div class="highlight"><pre>

</pre></div>
  </div>
  <div class="fleur">h</div>

</div>
</body>
</html>
